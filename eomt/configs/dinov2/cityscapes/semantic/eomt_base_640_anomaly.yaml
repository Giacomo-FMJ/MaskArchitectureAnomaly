trainer:
  max_epochs: 50
  logger:
    class_path: lightning.pytorch.loggers.wandb.WandbLogger
    init_args:
      resume: allow
      project: "eomt-anomaly"
      name: "anomaly_detection_eomt_ext_base_640"

model:
  class_path: training.mask_classification_semantic_anomaly.MCS_Anomaly
  init_args:
    img_size: [640, 640]
    num_classes: 2
    attn_mask_annealing_enabled: true
    attn_mask_annealing_start_steps: [3317, 8292, 13268]
    attn_mask_annealing_end_steps: [6634, 11609, 16585]
    ignore_idx: 255
    lr: 1.0e-4
    llrd: 0.8
    llrd_l2_enabled: true
    lr_mult: 1.0
    weight_decay: 0.05
    poly_power: 0.9
    warmup_steps: [500, 1000]
    num_points: 12544
    oversample_ratio: 3.0
    importance_sample_ratio: 0.75
    mask_coefficient: 5.0
    dice_coefficient: 5.0
    anomaly_coefficient: 2.0
    delta_weights: false
    load_ckpt_class_head: false
    # Pass the pretrained checkpoint here; override from CLI if needed
    ckpt_path: "/ABSOLUTE/PATH/TO/pretrained_eomt.ckpt"
    network:
      class_path: models.eomt_ext.EoMT_EXT
      init_args:
        num_classes: 2
        num_q: 100
        num_blocks: 3
        masked_attn_enabled: true
        encoder:
          class_path: models.vit.ViT
          init_args:
            backbone_name: vit_base_patch14_reg4_dinov2

# DataModule wrapper around GenericAnomalyDataset
# IMPORTANT: set data.init_args.ds_cfg.root to your dataset root
# (e.g., /content/drive/MyDrive/datasets/RoadAnomaly21)
data:
  class_path: dsets.anomaly_data_module.AnomalyDataModule
  init_args:
    batch_size: 4
    num_workers: 4
    num_classes: 2
    stuff_classes: [0, 1]
    img_size: [640, 640]
    ds_cfg:
      name: "RoadAnomaly21"
      # Override via CLI: --data.ds_cfg.root /content/drive/MyDrive/datasets/RoadAnomaly21
      root: "/ABSOLUTE/PATH/TO/RoadAnomaly21"
      images_dir: "images"
      masks_dir: "labels_masks"
      image_glob: "*"
      mask_ext: "png"
      gt_format: "binary_any_nonzero_is_ood_void255"
      skip_no_ood: false
